<?php   
  /*
    called by the parent of the target. e.g. 
    copy /a/b/ to /c/
      calls /c/system.copy.phtml?source=/a/b/
      results in /c/b/
    copy /a/b/ to /c
      calls /system.copy.phtml?source=/a/b/&target=/c/
      results in /c/
      if /c/ exists, fail
        calling template should first remove it
    FIXME: implement above description :)
  */
  if ($this->CheckSilent("add")) {
    if (!$source || !$this->exists($source)) {
      $this->error=sprintf($ARnls["err:wrongpath"],$source);
    } else {
      if (!$target) {
        $target=end(explode("/",$source));
        if (!$target) {
          $target="{5:id}"; // can only happen if $source=="/" ?
        }
      }
      $object=$this->get($source, "system.get.phtml");
      if ($object && is_array($object)) {
        $object=$object[0];
        if (!$object->copyto($this->path.$target."/")) {
          $this->error=$object->error;
        }
      } else {
        $this->error=$ARnls["accessdenied"];
      }
    }
  } else {
    $this->error=$ARnls["err:nopermission"];
  }
  if ($this->error) {
    $arResult=$this->error;
  }
?>