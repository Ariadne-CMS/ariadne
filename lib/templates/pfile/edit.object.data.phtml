<?php
  /******************************************************************
   edit.object.data.phtml			   Muze Ariadne v2.0b
   ------------------------------------------------------------------

   No result.

  ******************************************************************/

  if ($this->CheckLogin("edit") && $this->CheckConfig()) {
    include($this->store->code."widgets/wizard/code.php");

    $summary="edit.object.data.form.phtml";
    $language="edit.object.language.phtml";
    $save="edit.object.data.save.phtml";
    $i=0;

    $wgWizFlow[0]["current"]=$this->getdata("wgWizCurrent","none");
    $i++;
    $wgWizFlow[$i]["title"]=$ARnls["data"];
    $wgWizFlow[$i]["template"]=$summary;
    if (count($ARConfig->nls->list)>1) {
      $languagecontrol=true;
      $wgWizFlow[$i]["save"]=$i+2;
      $wgWizFlow[$i]["next"]=$i+1;
      $i++;
      $wgWizFlow[$i]["title"]=$ARnls["language"];
      $wgWizFlow[$i]["template"]=$language;
      $wgWizFlow[$i]["next"]=$i-1;;
      $wgWizFlow[$i]["prev"]=$i-1;
      $wgWizFlow[$i]["save"]=$i+1;
    } else {
      $wgWizFlow[$i]["save"]=$i+1;
    }
    $i++;
    $wgWizFlow[$i]["title"]=$ARnls["save"];
    $wgWizFlow[$i]["template"]=$save;
    $wgWizFlow[$i]["back"]=$i-1;

    global $HTTP_POST_VARS, $HTTP_POST_FILES;    
    if ($wgWizFlow[0]["current"]==1) {
      $arControl=$this->getdata("wgWizControl","none");
      if (($arControl==$ARnls["next"]) || ($arControl==$ARnls["save"])) {
        // check whether the file has changed
        $file_temp=$HTTP_POST_FILES['file']['tmp_name'];
        $file=$HTTP_POST_FILES['file']['name'];
        if ($file && is_uploaded_file($file_temp)) {
          // new file uploaded -> save it before PHP deletes it
          $file_artemp=tempnam($this->store->files."temp","upload");
          if (move_uploaded_file($file_temp, $file_artemp)) {
            // now make the new values available to wgWizKeepVars()
            $HTTP_POST_VARS["file"]=$file;
            $HTTP_POST_VARS["file_temp"]=substr($file_artemp,strlen($this->store->files."temp"));
            $HTTP_POST_VARS["file_size"]=$HTTP_POST_FILES['file']['size'];
            $HTTP_POST_VARS["file_type"]=$HTTP_POST_FILES['file']['type'];
          } 
        }
      }
    }
    $arLanguage=$this->getdata("arLanguage","none");
    if ($languagecontrol && $wgWizFlow[0]["current"]==2) { // =edit.object.language.phtml
      $arControl=$this->getdata("wgWizControl","none");
      if ($arControl==$ARnls["prev"]) { // if previous selected, ignore the language select list.
        $arLanguage=$this->getdata("arPrevLanguage","none");
        $ARCurrent->arLanguage=$arLanguage;
      }
    }
    if (!$arLanguage) { // language select hasn't been done yet, so start with default language
      $arLanguage=$ARConfig->nls->default;
      $ARCurrent->arLanguage=$arLanguage;
    }
    $HTTP_POST_VARS["arLanguage"]=$arLanguage;
    $wgWizControl=$this->getdata("wgWizControl","none");
    $wgWizCurrent=$this->getdata("wgWizCurrent","none");
    if ($wgWizControl && $wgWizCurrent) {
      $wgWizNextStep=$wgWizFlow[$wgWizCurrent][wgWizGetAction($wgWizControl)];
      $wgWizButtons=$wgWizFlow[$wgWizNextStep];
    }
    $result=$this->get("/system/ariadne/types/".$this->type."/","system.get.name.phtml");
    $wgWizTitle=$ARnls["edit"]." ".$result[0];    
    include($this->store->code."widgets/wizard/classic.html");
  }
?>