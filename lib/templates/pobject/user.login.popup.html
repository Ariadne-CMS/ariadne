<?php
	if (!$arLoginMessage) {
		$arLoginMessage=$ARnls["loginrequired"];
	}
	global $nocache;
	$nocache=true;
	// now make sure that the login template can use public resources:
	// remember the failed login user
	if ($ARCurrent->session) {
		$arLoginOld=$ARCurrent->session->get("ARLogin");
		$arPasswordOld=$ARCurrent->session->get("ARPassword");
		$arCallArgs.="&arLoginOld=".RawUrlEncode($arLoginOld);
		// when current user is logged on as public, then don't delete his
		// session.
		if ($AR->user && ($AR->user->data->login!="public")) {
			// now set the user back to 'public'
			$temp=$this->get("/system/users/public","system.get.phtml");
			if ($temp && $temp[0]) {
				$AR->user=$temp[0];
				$AR->user->grants=$this->GetValidGrants();
				// do not update the cookie and session data
				// cookies must be set only by login.phtml
				// just kill the session
				// $ARCurrent->session->kill();
				$ARCurrent->session->put("ARLogin","public");
				$ARCurrent->session->put("ARPassword","none");
			}
		}
	}
	if ($this->CheckConfig($arCallFunction, $arCallArgs)) {
?>
<html>
<head>
<title>Ariadne - <?php echo $arLoginMessage; ?></title>
<style>
	.width100 { width: 100; }
	.width200 { width: 200; }
	.width300 { width: 300; }
	H1		{ FONT: 12pt sans-serif; FONT-WEIGHT: bold; }
	TD		{ FONT: 10pt sans-serif; }
	BODY	{ FONT: 10pt sans-serif;
		  		BORDER: 0;
				BACKGROUND-COLOR: #FFFFFF;
				MARGIN: 0;
				PADDING: 0;
	}
	IMG 	{
				BORDER: 0;
				MARGIN: 0;
				PADDING: 0;
	}
</style>
</head>
<body bgcolor="#BBBBBB" onLoad="init()">
<table border="0" cellpadding="0" cellspacing="0" margin="0">
<tr>
  <td rowspan="2"><img src="<?php echo $AR->dir->images; ?>clock.gif" alt="" align="left" border="0" hspace="0" vspace="0"></td>
  <td valign="top" align="right"><img src="<?php echo $AR->dir->images; ?>ariadne.gif" alt="Ariadne - Web Application Server" vspace="5">
<form name="login" method="POST" action="<?php echo $this->make_url(); ?>login.phtml">
<?php
	global $PATH_INFO, $QUERY_STRING; 
	if (!$arReturnPath) {
		$split=strrpos($PATH_INFO, "/");
		$function=substr($PATH_INFO,$split+1);
		$arReturnPath=$this->path;
	}
	if (!$arReturnTemplate) {
		$arReturnTemplate=$function;
		if ($QUERY_STRING) {
			$arReturnTemplate.="?$QUERY_STRING";
		}
	}
?>
<input type="hidden" name="arReturnPath" value="<?php echo $arReturnPath; ?>">
<input type="hidden" name="arReturnTemplate" value="<?php echo $arReturnTemplate; ?>">
<input type="hidden" name="arPopup" value="true">
<table align="center" border="0" width="300">
<tr>
<?php
  if ($arErrorMessage) {
?>
	<td align="center" colspan="2">
		<h1><?php echo $arErrorMessage; ?></h1>
	</td>
</tr><tr>
<?php
  }
?>
	<td colspan="2" align="center">
			<table width="50%" align="right">
			<tr>
				<td align="right"><?php echo $ARnls["user"]; ?>&nbsp;:</td>
				<td><input type="text" name="ARLogin" size="16" value="<?php echo $ARLogin; ?>"></td>
			</tr><tr>
				<td align="right"><?php echo $ARnls["password"]; ?>&nbsp;:</td>
				<td><input type="password" name="ARPassword" size="16"></td>
			</tr>
			</table>
	</td>
</tr><tr>
	<td colspan="2" align="right"><input type="submit" name="ok" value="&nbsp;<?php echo $ARnls["login"]; ?>&nbsp;"></td>
</tr>
</table>
</form>
</td>
</tr><tr><td valign="bottom" align="center">
  <small>&copy; 1998 - 2001 <a href="http://www.muze.nl/" target="_blank">muze</a>. Ariadne comes with ABSOLUTELY NO WARRANTY. 
  Ariadne is free software, you are welcome to redistribute it under certain <a href="help.about.license.phtml" target="_blank">conditions</a>.<br>&nbsp;
  </small>
</td></tr>
</table>
<script>
  function init() {
	document.login.ARLogin.focus();
  }
</script>
</body>
</html>
<?php
	}
	if ($ARCurrent->session && $arLoginOld && $arPasswordOld) {
		$ARCurrent->session->put("ARLogin",$arLoginOld);
		$ARCurrent->session->put("ARPassword",$arPasswordOld);
	}
?>