<?php

debug("pfile: Load","object");
include_once($this->code."objects/pobject.phtml");

class pfile extends pobject { // definitie class

	function ShowFile() {
		if (!ereg("^text/",$this->data->mimetype)) {
			$size=filesize($this->store->files."files".$this->path."/view=");
		}
		if (ldSetContent($this->data->mimetype, $size)) {
			$cacheseconds=1800; // 1/2 hour
			$expires=time()+$cacheseconds;
			ldSetClientCache(true, $expires);
		} else if(!ereg("^text/",$this->data->mimetype)) {
			error("headers already sent and this is not a text file (".$this->path.")");
			$stop=true;
		}
		if( !$stop ) {
			if ($this->data->mimetype=="text/html") { // parse {arRoot}
				echo str_replace("{arRoot}",$this->store->root,@implode("",@file($this->store->files."files".$this->path."/view=")));
			} else {
				@readfile($this->store->files."files".$this->path."/view=");
			}
		}
	}

  function _ShowFile() {
    return $this->ShowFile();
  }
  
} // end class pfile
?>