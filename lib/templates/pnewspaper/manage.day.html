<?php
	if ($this->CheckLogin("read") && $this->CheckConfig($arCallFunction, $arCallArgs)) {
		global $PHP_SELF, $QUERY_STRING;
		if (!$arLanguage) {
			$arLanguage=$nls;
		}
		if ($data->$arLanguage) {
			$nlsdata=$data->$arLanguage;
		}

	if (!$date) {
		$date=time();
	}
	$ARCurrent->date=$date;
	$date_arr=getdate($date);
	$start=mktime(0,0,0,$date_arr["mon"],$date_arr["mday"],$date_arr["year"])-2;
	$end=mktime(0,0,0,$date_arr["mon"],$date_arr["mday"]+1,$date_arr["year"])-3;

	$this->clear_articles();
	$oldnls=$nls;
	$this->setnls($arLanguage);
	$articles=$this->get_articles("default",0,$start, $end);
	$this->setnls($oldnls);
?>
<style><!--
	A.cal { text-decoration: none; }
	.text { width: 120px; height: 17px; overflow: hidden; }
//--></style>
<table border="0" cellspacing="0" cellpadding="0" width="90%" align="center">
	<tr>
		<td><a href="<?php echo $PHP_SELF."?".$QUERY_STRING; ?>&date=<?php
				echo mktime(0,0,0,$date_arr["mon"],$date_arr["mday"]-1,$date_arr["year"]);
			?>">&lt;&lt;</a></td>
		<td align="center"><?php
				echo $date_arr["month"]." ".$date_arr["mday"].", ".$date_arr["year"];
			?></td>
		<td align="right"><a href="<?php echo $PHP_SELF."?".$QUERY_STRING; ?>&date=<?php
				echo mktime(0,0,0,$date_arr["mon"],$date_arr["mday"]+1,$date_arr["year"]);
			?>">&gt;&gt;</a></td>
	</tr><tr>
		<td bgcolor="#F6EEE6" colspan="3">
			<table border="0" cellspacing="0" cellpadding="0" width="100%">
				<tr>
					<td></td>
					<td><img src="<?php echo $AR->dir->images; ?>dot.gif" width="4" height="4"></td>
					<td><img src="<?php echo $AR->dir->images; ?>dot.gif" width="120" height="4"></td>
				</tr>
				<?php
					$dottedline="<tr><td colspan=\"3\" background=\"".$AR->dir->images."calendar/dots.gif\"><img src=\"".$AR->dir->images."dot.gif\" height=\"1\" width=\"1\"></td></tr>\n";
					if (is_array($articles)) {
						while (list($key, $article)=@each($articles)) {
							$from_fmt=strftime("%H:%M",$article->data->starttime);
							$row="<tr><td align=\"right\" valign=\"top\">";
							$row.="$from_fmt";
							$row.="</td><td></td><td valign=\"top\">";
							$row.="<div class='text'><a class=\"cal\" href=\"javascript:arEdit('".$article->path."');\">".$article->nlsdata->name."</a></div>";
							$row.="</td>";
							$row.="</tr>\n";
							$row.=$dottedline;
							echo $row;
						}
					} else {
						$row="<tr><td>&nbsp;</td><td></td><td>&nbsp;</td></tr>\n".$dottedline;
						echo $row;
					}
				?>
			<tr><td><img src="<?php echo $AR->dir->images; ?>dot.gif" width="4" height="4"></td></tr>
		</table>
	</td>
</tr>
</table>
<?php
	} // end login check.
?>