<?php
  if ($this->CheckLogin("read") && $this->CheckConfig($arCallFunction, $arCallArgs)) {
    if ($data->language) {
      $nls=$data->language;
	  ldSetNls($nls);
    }
	global $root, $rootoptions;
	ldSetRoot($ARCurrent->session->id, $nls);
?>
<HTML>
<HEAD>
<TITLE>Ariadne<?php
print ": ".$AR->user->data->name.'/'.$AR->user->data->login;
?></TITLE>
<script>
<!--

var cacheTemplate;
var loader;


var ARregistry=new Array();

<?php

	if( $this->data->windowprefs["edit_object_layout"] ) {
		echo "ARregistry['window_new_layout']=1;\n";
	}
	if( $this->data->windowprefs["edit_object_grants"] ) {
		echo "ARregistry['window_new_grants']=1;\n";
	}

?>

function Set(name, value) {
  ARregistry[name]=new String(value);
}

function Get(name) {
	var result;
	if (ARregistry[name]) {
		result=ARregistry[name];
	} else {
		result=0;
	}
	return result;
}

function View(link, template) {
  var arLanguage;
  var append;
  var target;

  if (link=="..") {
    link="/";
  }

//  alert('Viewing ('+link+')');

  arLanguage=Get("arLanguage");
  if (arLanguage) {
    append='&arLanguage='+escape(arLanguage);
  } else {
    append='';
  }

  if (template) {
    target='?template='+escape(template);
    window.cacheTemplate=escape(template);
  } else {
    if (window.cacheTemplate) {
      target="?template="+window.cacheTemplate;
    } else {
      target='?template=classic.manage.html'; // set default template
    }
  }
<?php if ($data->interface=="winxp") { ?>
	template='winxp.view.phtml';
	window.tree.treeload.location.href='<?php echo $root; ?>/manage.goto.phtml?link='+escape(link)+'&template='+escape(template)+append;
<?php } else if ($data->interface!="new") { ?>
  window.view.location.href='<?php echo $AR->dir->www; ?>view.php<?php echo $rootoptions; ?>'+link+target+append;
<?php } else { ?>
  template='view.phtml';
  window.tree.treeload.location.href='<?php echo $root; ?>/manage.goto.phtml?link='+escape(link)+'&template='+escape(template)+append;
<?php } ?>
}


function Loading() {
  window.tree.treeload.location.href='<?php echo $AR->dir->www; ?>loading.html';
}

function LoadingDone() {
  window.tree.treeload.location.href='<?php echo $AR->dir->www; ?>loadingdone.html';
}

function init() {
  loader=window.tree.treeload;
  treeview=window.tree.treeview;
  <?php 
	  $startpath = $this->getdata('path');
	  if ($startpath) {
		  echo 'View("'.$startpath.'");';
	  }
  ?>
}

loader=0;

  function toggletree() {
    if (document.treestatus=='hidden') {
      silent_showtree();
    } else {
      silent_hidetree();
    }
    return document.treestatus;
  }

  function silent_hidetree() {
    if (document.all) {
      document.body.cols="0,*";
      document.treestatus=new String('hidden');
    }
  }

  function silent_showtree() {
    if (document.all) {
      document.body.cols="200,*";
      document.treestatus=new String('visible');
    }
  }

  function hidetree() {
    silent_hidetree();
    if (document.all && (expl_icon=window.view.document.all['explorerbar_icon'])) {
      expl_icon.className='unselectedOption';
    }
  }

  function gettreestatus() {
    return document.treestatus;
  }

  document.treestatus=new String('visible');

// setting session ID for unique naming of windows within one ariadne session.
  top.Set("SessionID","<?php echo $ARCurrent->session->id; ?>");

//--></script>
<style>
  FRAME, FRAMESET {
    BORDER: 0;
  }
</style>
</HEAD>
<FRAMESET COLS="200,*" onLoad="init();">
  <FRAME NAME="tree" 
    SRC="<?php echo $AR->dir->www; ?>widgets/tree/root.php?wwwroot=<?php echo $AR->dir->www; ?>&loader=<?php echo $this->store->root; ?>&path=<?php 
    echo RawUrlEncode($AR->user->path); ?>&interface=<?php echo $data->interface; ?>" marginwidth="0" marginheight="0" >
  <FRAME NAME="view" SRC="<?php echo $this->store->root; ?>/system/ariadne/news/" marginwidth="0" marginheight="0">
</FRAMESET>
</HTML>
<?php
  }
?>