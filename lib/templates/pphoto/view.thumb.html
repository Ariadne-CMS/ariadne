<?php
	/******************************************************************
	 view.thumb.html                                       Muze Ariadne
	 ------------------------------------------------------------------
	 Arguments: none
	 Grant needed: read
	 Global variables: none

	 This displays a thumbnail of the image.

	 no result.

	******************************************************************/
	$ARCurrent->nolangcheck=true;
	if ($this->CheckLogin("read") && $this->CheckConfig($arCallFunction, $arCallArgs)) {
		$configcache=$ARConfig->cache[$this->path];
		$thumbwidth=$configcache->thumb["width"];
		$thumbheight=$configcache->thumb["height"];
		$thumbcolor=$configcache->thumb["color"];		
		ldSetClientCache(true, time()+7200);
		if (!$this->cached("ar_thumb_".$thumbwidth."x".$thumbheight.$thumbcolor)) {
			$result=$this->scale($thumbwidth, $thumbheight, $thumbcolor);
			if ($result) {
				ldSetContent("image/png");
				echo $result;
				$this->savecache(999);
			} else if ($this->path!="/system/photo/nothumb/") {
				$this->get("/system/photo/nothumb/","view.html");
				$this->savecache(0);
			} else {
				echo $this->error;
				$this->savecache(0);
			}
		}
	}
?>