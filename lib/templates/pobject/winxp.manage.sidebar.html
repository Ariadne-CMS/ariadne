<?php
	if ($this->CheckLogin("read") && $this->CheckConfig($arCallFunction, $arCallArgs)) {
		global $QUERY_STRING, $invisibleSections;
		if (!$arLanguage) {
			$arLanguage=$nls;
			if (is_array($arCallArgs)) {
				$arCallArgs["arLanguage"]=$nls;
				$arCallArgs["invisibleSections"]=$invisibleSections;
			} else {
				$arCallArgs.="&arLanguage=$nls&invisibleSections=$invisibleSections";
			}
		}
		if ($data->$arLanguage) {
			$nlsdata=$data->$arLanguage;
		}
?>
<html>
<head>
	<link href="winxp.manage.sidebar.css" rel="StyleSheet" type="text/css">
	<title>Ariadne - <?php echo $nlsdata->name; ?></title>
	<script language="JavaScript1.2" 
			src="<?php echo $AR->dir->www; ?>widgets/menu/functions.js"
	        type='text/javascript'>
	</script>	
<script language="javascript">
	tree=1;
	var invisibleSections;
	
	function View(path) {
		document.location.href='<?php echo $this->store->root; ?>'+path+'view.phtml';
	}
	function LoadingDone() {
		parent.LoadingDone();
	}
	function objectadded() {
		document.location.href=document.location.href;
	}

	function arEdit(object, arguments) {
		arshow('edit_object_data','<?php echo $this->store->root; ?>'+object+'edit.object.data.phtml', arguments);
	}
	
	function isCollapsed(section) {
		if (document.getElementById(section + '_body').style.visibility == 'hidden')
			return false;
		else
			return true;
	}
	
	function makeHotOrNot(object, section, normal, hot){
		var coll = isCollapsed(section)?'collapse':'expand';
		var norm = normal?'normal':'special';
		var ht = hot?'_hot':'';
		object.src = '<?php echo $AR->dir->images ?>winxp/' + norm + coll + ht + '.png';
	}
	
	function toggleSection(section, normal) {
		if (document.getElementById(section + '_body').style.visibility == 'hidden'){
			document.getElementById(section + '_body').style.visibility = 'visible';
			document.getElementById(section + '_body').style.height='auto';
			removeFromCookie(section);
		} else {
			document.getElementById(section + '_body').style.visibility = 'hidden';
			document.getElementById(section + '_body').style.height='1px';
			addToCookie(section);
		}
		makeHotOrNot(document.getElementById(section + '_togglebutton'), section, normal, false);
	}
	
	function removeFromCookie(section){
		if (invisibleSections != null){
			var newArray = new Array();
			var hasChanged = false;
			for (var i=0;i<invisibleSections.length;i++) {
				if (invisibleSections[i].toLowerCase() == section.toLowerCase() || invisibleSections[i] == "")
					hasChanged = true;
				else
					newArray[newArray.length] = invisibleSections[i];
			}
			if (hasChanged){
				invisibleSections = newArray;
				setInvisiblesCookie();
			}
		}
	}
	
	function addToCookie(section) {
		invisibleSections[invisibleSections.length] = section;
		setInvisiblesCookie();
	}
	
	function setInvisiblesCookie() {
		if(invisibleSections != null){
			var value = invisibleSections.join(";");
			if (value)
				value += ";";
			var today = new Date();
			var expiry = new Date(today.getTime() + 365 * 24 * 60 * 60 * 10000);
			document.cookie="invisibleSections="+escape(value)+";path=/;expires="+expiry.toGMTString();
		}
    }
    
	function getInvisiblesCookie() {
		var arg="invisibleSections=";
		var alen=arg.length;
		var clen=document.cookie.length;
		var i1=0;
		var j, endstr;
		while(clen>i1) {
		    j=i1+alen;
		    if (document.cookie.substring(i1,j)==arg) {
				endstr=document.cookie.indexOf(";",j);
				if(endstr==-1) 
					endstr=document.cookie.length;
				var sCookie = unescape(document.cookie.substring(j,endstr));
				sCookie = sCookie.substring(0,sCookie.length-1);
				invisibleSections = sCookie.split(";");
		    }
	    	i1=document.cookie.indexOf(" ", i1)+1;
	    	if(i1==0) break;
		}
		if (invisibleSections == null)
			invisibleSections = new Array();
    }
	
</script>
</head>
<body onload="getInvisiblesCookie()">
	<div class="sidebar">
		<img width="32" height="32" src="<?php echo $AR->dir->images."icons/".$this->type; ?>_open.gif" id="icon" align="left">
		<?php 
			//tasks
			$this->call("winxp.manage.sidebar.tasks.html", $arCallArgs);
			$this->call("winxp.manage.sidebar.settings.html", $arCallArgs);
			$this->call("winxp.manage.sidebar.info.html", $arCallArgs); 
			$this->call("winxp.manage.details.html", $arCallArgs); 
		?>
	</div>
</body>
</html>

<?php
	}
?>