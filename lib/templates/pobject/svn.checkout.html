<pre>
<?php
        if ($this->CheckLogin("layout") && $this->CheckConfig()) {
		$repository = $this->data->custom['none']['svn'];

		$username = $_POST['username'];
		$password = $_POST['password'];

		if (! (isset($username) && isset($password)) ) {
			?>
				<form method="post">
					<input type="text" name="username">
					<input type="password" name="password">
					<input type="submit" value="checkout">
				</form>
			<?php
		} else {

			if (isset($repository)) {
				$fstore	= $this->store->get_filestore_svn("templates");
				$svnstack = &PEAR_ErrorStack::singleton('VersionControl_SVN');
				$svn	= $fstore->connect($this->id, $repository, $username, $password);

			/*	if ($output = $svn['instance']->list->run(array('https://svn.muze.nl/svn/ariadne/trunk/lib/modules'), array())) {
				} else {
					echo "Errors: <br>";

			    if (count($errs = $svnstack->getErrors())) { 
			        foreach ($errs as $err) {
			            echo '<br />'.$err['message']."<br />\n";
			            echo "Command used: " . $err['params']['cmd'];
			        }
			    }
			}
			*/

			$result = $fstore->svn_checkout($svn);
			print_r($result);

			if ($result) {
				foreach ($result as $item) {
				    // _pobject.print_r.html.any.pinp
					$filename = basename($item['name']);
					$filename = substr($filename, 1);

					echo "Fetched $filename\n";
					
					ob_start();
						@readfile($item['name']);
						$template = ob_get_contents();
					ob_end_clean();

					$meta = array();
					$meta['ar:default']		= $fstore->svn_propget($svn, "ar:default", $filename);
					$meta['ar:type']		= $fstore->svn_propget($svn, "ar:type", $filename);
					$meta['ar:function']	= $fstore->svn_propget($svn, "ar:function", $filename);
					$meta['ar:language']	= $fstore->svn_propget($svn, "ar:language", $filename);

					if($meta['default'] == '1') {
						$meta['default'] = 1;
					}
						
					echo "Meta information:\n";
					echo "ar:default [" . $meta['ar:default'] . "]\n";
					echo "ar:type [" . $meta['ar:type'] . "]\n";
					echo "ar:function [" . $meta['ar:function'] . "]\n";
					echo "ar:language [" . $meta['ar:language'] . "]\n";


					$this->call("system.save.layout.phtml", Array(
						"template" 	=> $template,
						"default"	=> $meta['ar:default'],
						"type"		=> $meta['ar:type'],
						"function"	=> $meta['ar:function'],
						"language"	=> $meta['ar:language']
					));

					if ($this->error) {
						echo "Error saving template\n";
						print_r($this->error);
						// FIXME: do something useful with errors.
					}
				}
			}
		}
	}
}
?>
</pre>